using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Builder;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using Shadower.Data;
using Shadower.Data.Models;
using Shadower.Services;

namespace Shadower.Web.Infrastructure.Extensions
{
    public static class ApplicationBuilderExtensions
    {
        public static IApplicationBuilder Seed(this IApplicationBuilder app)
        {
            using (var serviceScope = app.ApplicationServices.GetRequiredService<IServiceScopeFactory>().CreateScope())
            {
                serviceScope.ServiceProvider.GetService<ShadowerDbContext>().Database.Migrate();

                var db = serviceScope.ServiceProvider.GetService<ShadowerDbContext>();
                var postService = serviceScope.ServiceProvider.GetService<IPostService>();
                Task.Run(async () =>
                {
                    if (!await db.Posts.AnyAsync())
                    {
                        var bobiLink = @"https://i.imgur.com/xuc1CCU.jpg";
                        var bobiEmbedding = new List<double>
                        {
                            1.4051275  , 0.8755349  , 1.542957   ,-0.23951182 ,-0.79993623 , 0.12106702  ,
                            0.8507303  ,-0.9523037  ,-0.250275   , 0.9972286  ,-1.9821662  , 0.65409577  ,
                            -1.2325717 ,  0.9190285 ,  0.31528693, -1.1006049 ,  0.56392074,  0.15813404 ,
                            -0.32810163, -0.7736968 ,  2.1471174 , -1.5124235 , -1.1245581 , -1.7689415  ,
                            0.30258158 ,-0.6558241  , 0.33762208 , 0.40169063 ,-1.8176224  ,-0.12090617  ,
                            0.5089931  , 1.96339    , 0.6216104  , 1.2145545  ,-0.39232603 ,-0.49411374  ,
                            -0.36493775, -1.183929  , -0.18819013, -0.4337981 , -0.2776676 ,  1.9471381  ,
                            -1.2648636 , -1.9159319 ,  0.14091632, -0.25202787,  0.7511601 ,  2.2877712  ,
                            -0.2925429 ,  0.77103126, -1.2014148 , -0.63187873, -0.18727952,  0.255099   ,
                            3.1111138  ,-0.9408283  , 0.13530238 , 1.1999139  , 0.35402328 ,-0.76429075  ,
                            -0.82632697, -0.870037  ,  0.24669603,  1.1387817 ,  0.9621547 ,  0.40206683 ,
                            -0.8191855 ,  1.1494963 ,  0.51050144,  1.3505452 ,  0.19303097, -0.25568396 ,
                            1.3606299  , 0.79833245 ,-1.8998644  ,-0.76826143 ,-0.10027703 ,-1.3691946   ,
                            0.9526649  , 0.19284724 ,-0.5837854  ,-1.9983977  , 1.4445449  , 0.20369281  ,
                            0.8076701  , 1.2795702  , 1.6637647  ,-1.4319162  , 0.95992696 , 1.2720414   ,
                            -1.0845654 ,  2.207109  ,  0.0052748 , -0.16900101,  1.1187006 ,  0.52626985 ,
                            -0.61435384,  0.76045114, -0.27167538,  1.035946  , -0.60289   ,  1.8352667  ,
                            -2.2085533 , -1.6052274 ,  0.25586113, -0.6351543 , -1.5067903 ,  0.5012145  ,
                            -0.11023493,  0.39381817, -2.4125092 , -0.28486001, -1.3730255 ,  0.36133444 ,
                            -0.7854033 ,  1.7443407 , -0.8593291 , -0.05385581,  1.3114208 , -0.8891034  ,
                            -0.53167033,  0.37560126, -0.3303393 , -0.3578613 ,  0.62667394,  0.23192376 ,
                            0.86363435 , 0.35472962
                        };
                        postService.AddPost(bobiLink, new[] { bobiEmbedding });

                        var marianlink1 = @"https://i.imgur.com/RF2ms7n.jpg";

                        var marianembedding1 = new List<double>
                        {                                                                               
                            0.09382069 , 0.24692568 , 0.30289367 , 0.7821912  ,-0.32473892 ,-0.4838123  ,
                            0.85708016 ,-1.0261961  , 0.37147388 ,-0.6777106  ,-0.9993111  ,-0.8373203  ,
                            -0.48685002, -0.835503  , -0.7443131 , -0.3298409 , -1.070677  , -1.0573224 ,
                            -1.6831172 ,  0.9971274 ,  0.7450125 ,  0.9086029 ,  0.03167608, -1.1896358 ,
                            -0.89241445, -1.96345   ,  1.77184   ,  0.13062988, -1.7375156 ,  0.47522303,
                            -0.10482506, -0.24241073,  1.0620197 , -1.0298502 , -0.8094625 ,  0.12762806,
                            0.07081626 ,-1.1963146  , 0.2686432  , 0.78328013 ,-1.3342144  ,-1.0070759  ,
                            -2.0987172 , -1.7429346 , -0.01454076, -0.8557721 , -0.6591554 ,  0.91567874,
                            -2.2682264 , -0.30709055, -1.9720713 ,  0.18128842,  0.42267084,  1.7391206 ,
                            0.5476176  ,-0.02544663 ,-0.45483613 , 1.3660595  ,-0.7018072  ,-1.8250397  ,
                            -1.0179319 , -1.8212371 ,  1.1670055 , -0.8256243 , -0.5234694 ,  0.48002666,
                            1.0806959  , 1.3498487  ,-2.3701096  , 0.2914883  ,-0.91197205 , 0.18311802 ,
                            0.73494303 ,-1.6035684  ,-2.165267   ,-0.03075705 ,-0.49238318 , 0.21991096 ,
                            0.02255741 ,-0.38035697 , 0.3647161  ,-0.7105757  , 0.15098736 , 1.9972174  ,
                            -0.21583346, -0.20262581,  0.01343485, -1.6464287 ,  0.43370968, -1.2117391 ,
                            1.0040172  ,-2.2299862  ,-0.13450654 ,-0.47981152 ,-1.3347702  ,-0.6308293  ,
                            -0.96708405, -0.79390055,  0.84031534,  0.28675357, -0.20347282,  1.7401733 ,
                            0.3104747  , 0.6578024  , 0.40053847 ,-0.5599108  ,-1.02379    ,-0.727214   ,
                            0.21248275 , 1.0878792  , 0.22019964 ,-0.9385559  , 1.179081   , 1.073736   ,
                            -1.0068498 ,  0.4965537 , -2.1233928 , -0.02023253, -0.8457149 ,  0.65587175,
                            -0.71068174,  0.92628825, -0.71756405, -1.1454301 ,  0.63031375,  1.3990196 ,
                            0.73508656 , 1.0962352
                        };
                        postService.AddPost(marianlink1, new[] { marianembedding1 });

                        var marianlink2 = @"https://i.imgur.com/moXqdtk.jpg";

                        var marianembedding2 = new List<double>
                        {
                            0.16802764 , 1.2356724  ,-0.6511444  , 1.5756283  , 0.998952   ,-0.15796292 ,
                            0.12503801 ,-0.337575   , 1.900118   ,-1.9033234  ,-0.43064213 , 0.20960449 ,
                            -1.4000878 , -0.79542494, -0.7800878 ,  0.34704685, -0.16929705, -0.31746924,
                            -2.5325806 ,  1.2286714 ,  0.41957298,  1.1992651 ,  0.8248132 , -1.1329919 ,
                            -0.5201194 , -1.4446762 ,  0.48832634,  0.7312952 , -0.69876117,  0.5902101 ,
                            -0.61924124, -1.0608236 ,  0.44642845, -1.199612  , -0.59228355,  0.6180509 ,
                            -0.89476407, -1.7745467 , -0.2976194 ,  0.24525245, -0.97348917, -0.9072375 ,
                            -2.1922977 , -1.4094168 ,  1.7762978 , -0.82614416,  0.21267866,  0.5876161 ,
                            -1.8383197 ,  1.4526743 , -1.4432086 , -0.30691832,  0.6875387 ,  0.97326565,
                            0.24225035 , 0.3360918  , 0.44648117 , 0.6507507  ,-0.3814907  ,-0.0354161  ,
                            -0.6562124 , -1.5474715 ,  2.2902503 , -0.80069405,  0.26550275,  0.27774292,
                            0.5377944  , 1.760701   ,-1.7385703  ,-0.702798   ,-1.192417   , 1.0621482  ,
                            -0.64141434, -0.66957384, -1.4607826 , -1.0289218 ,  0.14672995,  0.05640565,
                            0.8287647  ,-0.62499976 ,-0.97692096 ,-0.96818376 , 1.0583515  , 0.67358065 ,
                            -0.4733648 , -0.1250914 ,  0.33706698, -1.4398572 ,  1.3005422 , -1.9427019 ,
                            1.0908678  ,-0.72430444 , 0.18335752 ,-0.66415054 ,-1.0677333  ,-1.4046078  ,
                            -1.2814409 , -1.0577368 , -1.131134  ,  0.56772196,  0.5710249 ,  2.0274591 ,
                            -0.27382603,  0.5669027 ,  0.69475377, -0.7765642 , -1.148014  , -1.6950424 ,
                            -0.43397695,  1.6128275 ,  0.03266782,  0.78927034,  1.6726859 ,  1.1893167 ,
                            -0.47227585, -0.14138894, -1.6496247 ,  0.9029782 ,  0.15574077,  0.32660514,
                            -0.88875157,  1.7154657 ,  1.0147947 , -1.3039082 ,  0.5462593 ,  0.3672649 ,
                            0.5283973  , 0.7880183
                        };

                        postService.AddPost(marianlink2, new[] { marianembedding2 });
                    }
                }).Wait();
            }

            return app;
        }
    }
}
